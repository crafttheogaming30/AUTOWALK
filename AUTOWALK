-- TS AutoWalk V2 (Session Only)
-- Motion-style UI | Local | Safe

-- SERVICES
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local plr = Players.LocalPlayer
local char = plr.Character or plr.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local hum = char:WaitForChild("Humanoid")

-- STATE
local recording = false
local paused = false
local playing = false
local loopOn = false
local speed = 120

local track = {}
local recordConn

-- UI ROOT
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "TS_AutoWalk"
gui.ResetOnSpawn = false

-- ===== UTILS =====
local function draggable(frame, handle)
	handle = handle or frame
	local drag, startPos, dragStart
	handle.InputBegan:Connect(function(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 then
			drag = true
			startPos = frame.Position
			dragStart = i.Position
			i.Changed:Connect(function()
				if i.UserInputState == Enum.UserInputState.End then drag = false end
			end)
		end
	end)
	UIS.InputChanged:Connect(function(i)
		if drag and i.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = i.Position - dragStart
			frame.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
end

local function notify(txt)
	local n = Instance.new("Frame", gui)
	n.AnchorPoint = Vector2.new(1,1)
	n.Position = UDim2.new(1,-20,1,-20)
	n.Size = UDim2.new(0,260,0,36)
	n.BackgroundColor3 = Color3.fromRGB(25,25,30)
	n.BorderSizePixel = 0
	Instance.new("UICorner", n).CornerRadius = UDim.new(0,10)

	local t = Instance.new("TextLabel", n)
	t.Size = UDim2.fromScale(1,1)
	t.BackgroundTransparency = 1
	t.Text = txt
	t.TextColor3 = Color3.fromRGB(235,235,235)
	t.Font = Enum.Font.Gotham
	t.TextSize = 13

	TweenService:Create(n, TweenInfo.new(0.25), {
		Position = UDim2.new(1,-20,1,-70)
	}):Play()

	task.delay(2, function()
		TweenService:Create(n, TweenInfo.new(0.25), {
			BackgroundTransparency = 1
		}):Play()
		TweenService:Create(t, TweenInfo.new(0.25), {
			TextTransparency = 1
		}):Play()
		task.delay(0.3, function()
			n:Destroy()
		end)
	end)
end

-- ===== WINDOW BUILDER =====
local function createWindow(title, pos, size)
	local w = Instance.new("Frame", gui)
	w.Position = pos
	w.Size = size
	w.BackgroundColor3 = Color3.fromRGB(18,18,22)
	w.BorderSizePixel = 0
	Instance.new("UICorner", w).CornerRadius = UDim.new(0,14)

	local header = Instance.new("Frame", w)
	header.Size = UDim2.new(1,0,0,34)
	header.BackgroundTransparency = 1

	local lbl = Instance.new("TextLabel", header)
	lbl.Position = UDim2.new(0,14,0,0)
	lbl.Size = UDim2.new(1,-100,1,0)
	lbl.BackgroundTransparency = 1
	lbl.Text = title
	lbl.TextColor3 = Color3.fromRGB(235,235,235)
	lbl.Font = Enum.Font.Gotham
	lbl.TextSize = 14
	lbl.TextXAlignment = Left

	local min = Instance.new("TextButton", header)
	min.Text = "—"
	min.Size = UDim2.new(0,32,0,24)
	min.Position = UDim2.new(1,-72,0,5)
	min.BackgroundTransparency = 1
	min.TextColor3 = Color3.fromRGB(200,200,200)
	min.Font = Enum.Font.GothamBold
	min.TextSize = 16

	local cls = Instance.new("TextButton", header)
	cls.Text = "×"
	cls.Size = UDim2.new(0,32,0,24)
	cls.Position = UDim2.new(1,-36,0,5)
	cls.BackgroundTransparency = 1
	cls.TextColor3 = Color3.fromRGB(200,200,200)
	cls.Font = Enum.Font.GothamBold
	cls.TextSize = 16

	local body = Instance.new("Frame", w)
	body.Position = UDim2.new(0,0,0,34)
	body.Size = UDim2.new(1,0,1,-34)
	body.BackgroundTransparency = 1

	min.MouseButton1Click:Connect(function()
		body.Visible = not body.Visible
	end)
	cls.MouseButton1Click:Connect(function()
		w:Destroy()
	end)

	draggable(w, header)
	return w, body
end

-- ===== MAIN MENU =====
local mainW, mainB = createWindow(
	"TS Auto",
	UDim2.new(0.05,0,0.2,0),
	UDim2.new(0,360,0,180)
)

local autoBtn = Instance.new("TextButton", mainB)
autoBtn.Size = UDim2.new(0,160,0,40)
autoBtn.Position = UDim2.new(0,20,0,20)
autoBtn.Text = "Auto Walk"
autoBtn.Font = Enum.Font.Gotham
autoBtn.TextSize = 14
autoBtn.TextColor3 = Color3.fromRGB(240,240,240)
autoBtn.BackgroundColor3 = Color3.fromRGB(30,30,36)
autoBtn.BorderSizePixel = 0
Instance.new("UICorner", autoBtn).CornerRadius = UDim.new(0,10)

-- ===== AUTO WALK WINDOW =====
autoBtn.MouseButton1Click:Connect(function()
	local aw, body = createWindow(
		"Auto Walk",
		UDim2.new(0.18,0,0.22,0),
		UDim2.new(0,420,0,360)
	)

	local y = 16
	local function btn(text, cb)
		local b = Instance.new("TextButton", body)
		b.Size = UDim2.new(0,180,0,34)
		b.Position = UDim2.new(0,20,0,y)
		y += 40
		b.Text = text
		b.Font = Enum.Font.Gotham
		b.TextSize = 13
		b.TextColor3 = Color3.fromRGB(235,235,235)
		b.BackgroundColor3 = Color3.fromRGB(30,30,36)
		b.BorderSizePixel = 0
		Instance.new("UICorner", b).CornerRadius = UDim.new(0,8)
		b.MouseButton1Click:Connect(cb)
	end

	btn("Record Track", function()
		if recording then return end
		track = {}
		recording = true
		paused = false
		notify("Record ON")

		recordConn = RunService.Heartbeat:Connect(function()
			if recording and not paused then
				table.insert(track, hrp.Position)
			end
		end)
	end)

	btn("Pause Record", function()
		if recording then
			paused = not paused
			notify(paused and "Record Paused" or "Record Resumed")
		end
	end)

	btn("Stop Record", function()
		if recording then
			recording = false
			if recordConn then recordConn:Disconnect() end
			notify("Record Stopped")
		end
	end)

	btn("Play Track", function()
		if playing or #track == 0 then return end
		playing = true
		notify("Play Track")

		task.spawn(function()
			repeat
				for _,pos in ipairs(track) do
					if not playing then break end
					hrp.CFrame = CFrame.new(pos)
					task.wait(math.clamp(1/(speed/10), 0.01, 0.2))
				end
			until not loopOn
			playing = false
		end)
	end)

	btn("Loop: Toggle", function()
		loopOn = not loopOn
		notify(loopOn and "Loop ON" or "Loop OFF")
	end)

	-- SPEED SLIDER
	local sliderBg = Instance.new("Frame", body)
	sliderBg.Position = UDim2.new(0,220,0,20)
	sliderBg.Size = UDim2.new(0,160,0,6)
	sliderBg.BackgroundColor3 = Color3.fromRGB(40,40,46)
	Instance.new("UICorner", sliderBg).CornerRadius = UDim.new(1,0)

	local slider = Instance.new("Frame", sliderBg)
	slider.Size = UDim2.new(speed/500,0,1,0)
	slider.BackgroundColor3 = Color3.fromRGB(120,120,255)
	Instance.new("UICorner", slider).CornerRadius = UDim.new(1,0)

	local dragging = false
	sliderBg.InputBegan:Connect(function(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end
	end)
	sliderBg.InputEnded:Connect(function(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
	end)
	UIS.InputChanged:Connect(function(i)
		if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
			local x = math.clamp((i.Position.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
			speed = math.floor(x * 500)
			slider.Size = UDim2.new(x,0,1,0)
			notify("Speed: "..speed)
		end
	end)
end)
